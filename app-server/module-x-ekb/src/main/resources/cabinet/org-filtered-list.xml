<?xml version="1.0" encoding="UTF-8"?>
<cursor xmlns="http://bio4j.ru/biodef-repo/store"
        xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
        xsi:schemaLocation="http://bio4j.ru/biodef-repo/store http://bio4j.ru/biodef-repo/store/store-v10.xsd"
        multiselection="true">
  <SQL action="select">
    <text><![CDATA[
SELECT o1.*,
      case o1.orgtype 
      when 'l' then 'Киносеть'
      when 'h' then 'Киносеть'
      when 's' then 'Некоммерческая киносеть'
      when 'b' then 'Некоммерческая киносеть'
      when 'p' then 'Кинотеатр'
      end as orgtype_name,
      case o1.verstate when  '0' then 'не выверен'
      when '1' then 'в процессе'
      when '2' then 'адрес выверен'
      when '9' then 'выверен'
      end as verstatename
FROM org$cinemalst o1
WHERE o1.test = 1 AND o1.orgtype in ('p', 's', 'l')
AND (:SYS_CURUSR_ROLES in ('*','1','2','5','6'))
AND ((:parent_org_id is null) or (o1.holding_id = :parent_org_id))
AND
  (
    (nvl(o1.kladr_code_r, 'not_assigned') = decode(:region_id, null, nvl(o1.kladr_code_r, 'not_assigned'), :region_id)) and
    ((:nas_punkt is null)       or (upper(o1.nas_punkt) like '%'||upper(:nas_punkt)||'%')) and
    ((:street_name is null)       or (upper(o1.street_name) like '%'||upper(:street_name)||'%')) and
    ((:hldname is null)         or ((o1.holding_id = nvl(to_number(regexp_substr(:hldname, '^\d+$')), 0)) or
                                    (upper(o1.hldname) like '%'||upper(:hldname)||'%'))) and
    ((:orgname is null)         or ((o1.id_org = nvl(to_number(regexp_substr(:orgname, '^\d+$')), 0)) or
                                    (upper(o1.orgname) like '%'||upper(:orgname)||'%'))) and
    ((:email is null)           or (upper(nvl(o1.email, o1.email_hld)) like '%'||upper(:email)||'%')) and
    ((:orgname_jur is null)     or (upper(o1.orgname_jur) like '%'||upper(:orgname_jur)||'%')) and

    (nvl(o1.id_vnd, -1) = decode(:id_vnd, null, nvl(o1.id_vnd, -1), :id_vnd)) and
    (nvl(o1.id_prop, -1) = decode(:id_prop, null, nvl(o1.id_prop, -1), :id_prop)) and
    ((:orgtype is null) or (nvl(o1.orgtype, '-x') = :orgtype)) and

    --(nvl(o1.test, 0) = decode(:test, null, nvl(o1.test, 0), :test)) and
    (nvl(o1.liquidate, 0) = decode(:liquidate, null, nvl(o1.liquidate, 0), :liquidate)) and
    (nvl(o1.automatic, 0) = decode(:automatic, null, nvl(o1.automatic, 0), :automatic)) and
    (nvl(o1.original_dog, 0) = decode(:original_dog, null, nvl(o1.original_dog, 0), :original_dog)) and
    (nvl(o1.isreported, 0) = decode(:isreported, null, nvl(o1.isreported, 0), :isreported)) and
    (nvl(o1.whereisdata, 0) = decode(:whereisdata, null, nvl(o1.whereisdata, 0), :whereisdata)) and

    ((:registred is null) or (o1.registred = :registred)) and
    ((:modern is null) or (o1.modern = :modern)) and
    ( (:verState is null) or
      (o1.verstate in (select item from table(biosys.ai_utl.trans_list(:verState, ';'))))
    )
  )    
ORDER BY o1.orgname
    ]]></text>
    <param type="integer" name="parent_org_id"/>
    <param type="string" name="region_id"/>
    <param type="string" name="region"/>
    <param type="string" name="nas_punkt"/>
    <param type="string" name="street_name"/>
    <param type="string" name="hldname"/>
    <param type="string" name="orgname"/>
    <param type="string" name="email"/>
    <param type="boolean" name="test"/>
    <param type="boolean" name="liquidate"/>
    <param type="boolean" name="automatic"/>
    <param type="boolean" name="original_dog"/>
    <param type="boolean" name="isreported"/>
    <param type="boolean" name="whereisdata"/>
    <param type="integer" name="id_prop"/>
    <param type="string" name="prop"/>
    <param type="integer" name="id_vnd"/>
    <param type="string" name="vnd"/>
    <param type="string" name="orgtype"/>
    <param type="string" name="orgtype_name"/>
    <param type="string" name="orgname_jur"/>
    <param type="boolean" name="registred"/>
    <param type="boolean" name="modern"/>
    <param type="boolean" name="verSt0"/>
    <param type="boolean" name="verSt1"/>
    <param type="boolean" name="verSt2"/>
    <param type="boolean" name="verSt9"/>
    <param type="string" name="verState"/>
  </SQL>
 
  <fields>
    <field name="orgname" type="string" header="Кинотеатр" align="left" width="200"/>
    <field name="id_org" type="integer" header="ID" pk="true" format="0"/>
    <field name="orgtype_name" type="string" header="Тип" width="80"/>
    <field name="time_zone" type="integer" header="Часовой пояс" width="30"/>
    <field name="ownership" type="string" header="Ф/С" width="60"/>
    <field name="holding_id" type="integer" header="ID Киносети" width="40"/>
    <field name="hldname" type ="string" header="Киносеть" width="150"/>
    <field name="region" type="string" header="Регион" width="150" align="left"/>
    <field name="nas_punkt" type="string" header="Нас. пункт" width="150" align="left"/>
    <field name="street_name" type="string" header="Улица,Дом" width="150" align="left"/>
    <field name="email" type="string" header="E-mail" width="100"/>
    <field name="email_hld" type="string" header="E-mail \nкиносети" width="100"/>
    <field name="automatic" type="boolean" header="Билетная \nсистема" width="30"/>
    <field name="automatic_str" type="string" generate="false"/>
    <field name="modern" type="boolean" header="Современный" width="30"/>
    <field name="original_dog" type="boolean" header="Рег. карта" align="center" width="30"/>
    <field name="original_dog_str" type="string" generate="false"/>
    <field name="isreported" type="boolean" header="Отчитывается" align="center" width="30"/>
    <field name="isreported_str" type="string" generate="false"/>
    <field name="whereisdata" type="boolean" header="Молчит7дней" align="center" width="30"/>
    <field name="last_upld" type="date" header="Поледняя \nзагрузка" format="d.m.Y H:i:s" width="120"/>
    <field name="test" type="boolean" header="Тестовый" align="center" width="30"/>
    <field name="registred" type="boolean" header="Зарегистрирован" align="center" width="30"/>
    <field name="test_str" type="string" generate="false"/>
    <field name="liquidate" type="boolean" hidden="true"/>
    <field name="dog_num" type="string" header="Рег. номер"/>
    <field name="dog_date" type="date" format="d.m.Y" header="Дата регистрации" width="70"/>
    <field name="reg_date" type="date" format="d.m.Y" header="Дата ввода" width="70"/>
    <field name="locname" type="string" header="Размещение"/>
    <field name="state" type="integer" hidden="true"/>
    <field name="statename" type="string" header="Состояние"/>
    <field name="closereason_id" type="integer" hidden="true"/>
    <field name="closereason_name" type="string" header="Прим.\nк состоянию"/>
    <field name="respons_person" type ="string" header="Ответственное лицо"/>
    <field name="phone_fax" type ="string" header="Телефон/факс"/>
    <field name="id_k1" type="boolean" header="2D-1K" width="30"/>
    <field name="id_k1_str" type="string"  generate="false"/>
    <field name="id_k2" type="boolean" header="2D-2K" width="30"/>
    <field name="id_k2_str" type="string"  generate="false"/>
    <field name="id_k4" type="boolean" header="2D-4K" width="30"/>
    <field name="id_k4_str" type="string"  generate="false"/>
    <field name="id_3d" type="boolean" header="3D" width="30"/>
    <field name="id_3d_str" type="string"  generate="false"/>
    <field name="id_plenka" type="boolean" header="Пленка" width="30"/>
    <field name="id_plenka_str" type="string"  generate="false"/>
    <field name="analogsnd" type="boolean" header="Аналог \nЗвук" width="30"/>
    <field name="analogsnd_str" type="string"  generate="false"/>
    <field name="digitsnd" type="boolean" header="Цифровой \nЗвук" width="30"/>
    <field name="digitsnd_str" type="string"  generate="false"/>
    <field name="vndname" type="string" header="Поставщик ПО"/>
    <field name="orgname_jur" type="string" header="Наименование юр. лица"/>
    <field name="suspended" type="date" format="d.m.Y" header="Приостановлен до"/>
    <field name="verstatename" type="string" header="Состояние\nвыверки"/>
    <field name="sroom_cnt" type="integer" header="Кинозалов\nвсего"/>
    <field name="splace_cnt" type="integer" header="Мест\nвсего"/>
    <field name="space_ttl" type="decimal" header="Площадь\nобщая"/>
    <field name="recid_io" type="integer" header="Строка\nв исх. файле"/>
    <field name="silence_period" type="integer" header="Допустимый период\nмолчания"/>
    <field name="last_chng_usr" type="string" generate="false"/>
    <field name="last_chng_date" type="date" generate="false"/>
    <field name="last_chng_act" type="clob" generate="false"/>
    <field name="comments" type="string" generate="false"/>
    <field name="post_index" type="string" generate="false"/>
    <field name="address_jur" type="string" generate="false"/>
    <field name="ogrn" type="string" generate="false"/>
    <field name="inn" type="string" generate="false"/>
  </fields>
</cursor>

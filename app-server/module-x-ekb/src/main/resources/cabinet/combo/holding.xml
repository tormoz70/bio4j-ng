<?xml version="1.0" encoding="UTF-8"?>
<cursor xmlns="http://bio4j.ru/biodef-repo/store"
        xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
        xsi:schemaLocation="http://bio4j.ru/biodef-repo/store http://bio4j.ru/biodef-repo/store/store-v10.xsd">
  <SQL action="select">
    <text>
      <![CDATA[
--SELECT 0 as lvl, 0 as org_id, '<нет сети>' as org_name, '' as orgtype_name from dual
--union all
SELECT 1 as lvl, a.id_org as org_id, a.orgname as org_name, ot.orgtype_name
FROM givc_org.org a
     left join ORG$TYPES ot on ot.orgtype = a.orgtype
 WHERE a.orgtype in ('h', 'b') 
   AND (
    ((:orgname is null)       or ((a.id_org = nvl(to_number(regexp_substr(:orgname, '^\d+$')), 0)) or
                              (upper(a.orgname) like '%'||upper(:orgname)||'%')))
  )
order by lvl, org_name
      ]]>
    </text>
    <param type="string" name="orgname"/>
    <param type="string" name="orgtype"/>
  </SQL>

  <fields>
    <field name="org_id" type="integer" header="ID" pk="true"/>
    <field name="org_name" type="string" header="Название"/>
    <field name="orgtype_name" type="string" header="Тип организации"/>
  </fields>
</cursor>
